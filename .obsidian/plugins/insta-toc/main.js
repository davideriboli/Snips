/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var I=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var Y=(r,e)=>{for(var t in e)I(r,t,{get:e[t],enumerable:!0})},K=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of q(e))!G.call(r,i)&&i!==t&&I(r,i,{get:()=>e[i],enumerable:!(n=W(e,i))||n.enumerable});return r};var _=r=>K(I({},"__esModule",{value:!0}),r);var fe={};Y(fe,{default:()=>T});module.exports=_(fe);var p=require("obsidian");var d={defaultMerge:Symbol("deepmerge-ts: default merge"),skip:Symbol("deepmerge-ts: skip")},ye={defaultMerge:d.defaultMerge};function J(r,e){return e}function Q(r,e){return r.filter(t=>t!==void 0)}var R;(function(r){r[r.NOT=0]="NOT",r[r.RECORD=1]="RECORD",r[r.ARRAY=2]="ARRAY",r[r.SET=3]="SET",r[r.MAP=4]="MAP",r[r.OTHER=5]="OTHER"})(R||(R={}));function k(r){return typeof r!="object"||r===null?0:Array.isArray(r)?2:ee(r)?1:r instanceof Set?3:r instanceof Map?4:5}function X(r){let e=new Set;for(let t of r)for(let n of[...Object.keys(t),...Object.getOwnPropertySymbols(t)])e.add(n);return e}function Z(r,e){return typeof r=="object"&&Object.prototype.propertyIsEnumerable.call(r,e)}function w(r){let e=0,t=r[0]?.[Symbol.iterator]();return{[Symbol.iterator](){return{next(){do{if(t===void 0)return{done:!0,value:void 0};let n=t.next();if(n.done===!0){e+=1,t=r[e]?.[Symbol.iterator]();continue}return{done:!1,value:n.value}}while(!0)}}}}}var F=["[object Object]","[object Module]"];function ee(r){if(!F.includes(Object.prototype.toString.call(r)))return!1;let{constructor:e}=r;if(e===void 0)return!0;let t=e.prototype;return!(t===null||typeof t!="object"||!F.includes(Object.prototype.toString.call(t))||!t.hasOwnProperty("isPrototypeOf"))}function te(r,e,t){let n={};for(let i of X(r)){let o=[];for(let s of r)Z(s,i)&&o.push(s[i]);if(o.length===0)continue;let a=e.metaDataUpdater(t,{key:i,parents:r}),c=A(o,e,a);c!==d.skip&&(i==="__proto__"?Object.defineProperty(n,i,{value:c,configurable:!0,enumerable:!0,writable:!0}):n[i]=c)}return n}function ne(r){return r.flat()}function re(r){return new Set(w(r))}function ie(r){return new Map(w(r))}function oe(r){return r.at(-1)}var h={mergeRecords:te,mergeArrays:ne,mergeSets:re,mergeMaps:ie,mergeOthers:oe};function D(...r){return se({})(...r)}function se(r,e){let t=ae(r,n);function n(...i){return A(i,t,e)}return n}function ae(r,e){return{defaultMergeFunctions:h,mergeFunctions:{...h,...Object.fromEntries(Object.entries(r).filter(([t,n])=>Object.hasOwn(h,t)).map(([t,n])=>n===!1?[t,h.mergeOthers]:[t,n]))},metaDataUpdater:r.metaDataUpdater??J,deepmerge:e,useImplicitDefaultMerging:r.enableImplicitDefaultMerging??!1,filterValues:r.filterValues===!1?void 0:r.filterValues??Q,actions:d}}function A(r,e,t){let n=e.filterValues?.(r,t)??r;if(n.length===0)return;if(n.length===1)return S(n,e,t);let i=k(n[0]);if(i!==0&&i!==5){for(let o=1;o<n.length;o++)if(k(n[o])!==i)return S(n,e,t)}switch(i){case 1:return ce(n,e,t);case 2:return le(n,e,t);case 3:return de(n,e,t);case 4:return ue(n,e,t);default:return S(n,e,t)}}function ce(r,e,t){let n=e.mergeFunctions.mergeRecords(r,e,t);return n===d.defaultMerge||e.useImplicitDefaultMerging&&n===void 0&&e.mergeFunctions.mergeRecords!==e.defaultMergeFunctions.mergeRecords?e.defaultMergeFunctions.mergeRecords(r,e,t):n}function le(r,e,t){let n=e.mergeFunctions.mergeArrays(r,e,t);return n===d.defaultMerge||e.useImplicitDefaultMerging&&n===void 0&&e.mergeFunctions.mergeArrays!==e.defaultMergeFunctions.mergeArrays?e.defaultMergeFunctions.mergeArrays(r):n}function de(r,e,t){let n=e.mergeFunctions.mergeSets(r,e,t);return n===d.defaultMerge||e.useImplicitDefaultMerging&&n===void 0&&e.mergeFunctions.mergeSets!==e.defaultMergeFunctions.mergeSets?e.defaultMergeFunctions.mergeSets(r):n}function ue(r,e,t){let n=e.mergeFunctions.mergeMaps(r,e,t);return n===d.defaultMerge||e.useImplicitDefaultMerging&&n===void 0&&e.mergeFunctions.mergeMaps!==e.defaultMergeFunctions.mergeMaps?e.defaultMergeFunctions.mergeMaps(r):n}function S(r,e,t){let n=e.mergeFunctions.mergeOthers(r,e,t);return n===d.defaultMerge||e.useImplicitDefaultMerging&&n===void 0&&e.mergeFunctions.mergeOthers!==e.defaultMergeFunctions.mergeOthers?e.defaultMergeFunctions.mergeOthers(r):n}var O=/^(\s*)(-|\d+(?:\.\d+)*|\d\.)\s+(.*)/,x=/\[\[([^\]]+)\|([^\]]+)\]\]/g,b=/\[\[([^\]\|]+)\]\]/g,L=/\[([^\]]+)\]\([^)]+\)/g,P=/(#)([^\s]*\w)/g,y="insta-toc",$={dash:"dash",number:"number"},H=["*","_","`","==","~~","{","}","#","\\"];var C={bulletType:"dash",indentSize:4,updateDelay:2e3,excludedChars:H};var u=require("obsidian");var v=class extends u.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new u.Setting(e).setName("List bullet style").setDesc("Select the global list bullet type.").addDropdown(t=>t.addOptions($).setValue(this.plugin.settings.bulletType).onChange(async n=>{this.plugin.settings.bulletType=n,await this.plugin.saveSettings()})),new u.Setting(e).setName("Indentation width").setDesc("Select the global indentation size.").addSlider(t=>t.setLimits(2,8,2).setDynamicTooltip().setInstant(!0).setValue(this.plugin.settings.indentSize).onChange(async n=>{this.plugin.settings.indentSize=n,await this.plugin.saveSettings()})),new u.Setting(e).setName("Update delay").setDesc("The delay for each TOC update.").addSlider(t=>{t.setLimits(500,1e4,500).setDynamicTooltip().setInstant(!0).setValue(this.plugin.settings.updateDelay).onChange(async n=>{this.plugin.settings.updateDelay=n,await this.plugin.saveSettings(),this.plugin.updateModifyEventListener()})}),new u.Setting(e).setName("Excluded characters").setDesc("Characters to exclude in headings.").addTextArea(t=>{t.setValue([...this.plugin.settings.excludedChars].join(",")).onChange(async n=>{let i=t.getValue(),o=new Set([...i.replace(/,$/,"").replace(/^,/,"").split(",").map(a=>a.trim())]);this.plugin.settings.excludedChars=[...o],await this.plugin.saveSettings()}),t.inputEl.classList.add("exclude-chars")})}};var M=class{constructor(e,t,n,i){this.app=e,this.plugin=t,this.editor=n,this.file=i,this.headingLevelStack=[],this.fileCache=this.app.metadataCache.getFileCache(i),this.fileCache&&this.updateAutoToc()}getTocInsertPosition(e){let t=e.position.start.line,n=0,i=e.position.end.line,o=e.position.end.col;return{from:{line:t,ch:n},to:{line:i,ch:o}}}getIndentationLevel(e){for(;this.headingLevelStack.length>0&&e<=this.headingLevelStack[this.headingLevelStack.length-1];)this.headingLevelStack.pop();return this.headingLevelStack.push(e),this.headingLevelStack.length-1}generateNumberedToc(e){let t=[],n={};for(let o of e){let a=o.level,c=o.heading,s=this.getIndentationLevel(a);n[s]||(n[s]=0);for(let g=s+1;g<=6;g++)n[g]=0;n[s]++;let l=" ".repeat(s*4),f=n[s].toString(),m=`${l}${f}. ${c}`;t.push(m)}let i=t.join(`
`);return`\`\`\`${y}
${i}
\`\`\``}generateNormalToc(e){let t=[];for(let i of e){let o=i.level,a=i.heading,c=this.getIndentationLevel(o),l=`${" ".repeat(c*4)}- ${a}`;t.push(l)}let n=t.join(`
`);return`\`\`\`${y}
${n}
\`\`\``}getTocData(){let e=this.fileCache?.headings??[],t=this.fileCache?.sections?this.fileCache.sections.find(n=>n.type==="code"&&this.editor.getLine(n.position.start.line)===`\`\`\`${y}`):void 0;return{fileHeadings:e,instaTocSection:t}}updateAutoToc(){let{fileHeadings:e,instaTocSection:t}=this.getTocData();if(!t)return;let n=this.getTocInsertPosition(t),i;switch(this.plugin.settings.bulletType){case"dash":i=this.generateNormalToc(e);break;case"number":i=this.generateNumberedToc(e);break;default:i=this.generateNormalToc(e);break}this.editor.replaceRange(i,n.from,n.to)}};var U=require("obsidian");function V(r,e,t,n,i){let[,o,a,c]=n,{contentText:s,alias:l}=ge(e,c),f=r.fileManager.generateMarkdownLink(t,i,`#${s}`,l);return{indent:o,bullet:a,navLink:f}}function ge(r,e){let[t,n]=[e,e];return t=t.replace(x,(i,o,a)=>`${o} ${a}`),n=n.replace(x,(i,o,a)=>a),t=t.replace(b,(i,o)=>(o=o.split("/").pop()??o,o)),n=n.replace(b,(i,o)=>(o=o.split("/").pop()??o,o)),t=t.replace(L,(i,o)=>i),n=n.replace(L,(i,o)=>o),t=t.replace(P,(i,o,a)=>a),n=pe(n,r),{contentText:t,alias:n}}function pe(r,e,t){let n=(e?e.settings.excludedChars:t)??[],i=(0,U.htmlToMarkdown)(r);for(let o of n)i=i.replaceAll(o,"");return i}function N(r,e,t){r.querySelectorAll("li").forEach((i,o)=>{e[o]>1&&(i.style.marginInlineStart=`${t*10}px`);let c=i.querySelector("ul, ol");if(c){let s=document.createElement("button");s.textContent="\u25BE",s.classList.add("fold-toggle"),s.addEventListener("click",()=>{c.style.display==="none"?(c.style.display="",s.textContent="\u25BE"):(c.style.display="none",s.textContent="\u25B8")}),i.prepend(s)}})}var T=class extends p.Plugin{constructor(t,n){super(t,n);this.modifyEventRef=null;this.app=t}async onload(){console.log("Loading Insta TOC Plugin"),await this.loadSettings(),this.addSettingTab(new v(this.app,this)),this.registerMarkdownCodeBlockProcessor("insta-toc",async(t,n,i)=>{let o=i.sourcePath,a=o.substring(0,o.lastIndexOf(".")),c=this.app.vault.getAbstractFileByPath(o),s=t.split(`
`),l=[],f=s.map(m=>{let g=m.match(O);if(!g)return m;let{indent:E,bullet:B,navLink:j}=V(this.app,this,c,g,a),z=Math.floor(E.length/4)+1;return l.push(z),`${E}${B} ${j}`}).join(`
`);await p.MarkdownRenderer.render(this.app,f,n,o,this),N(n,l,this.settings.indentSize)}),this.updateModifyEventListener()}onunload(){console.log("Unloading Insta TOC Plugin")}async loadSettings(){let t=C,n=await this.loadData();n&&(t=D(C,n)),this.settings=t}async saveSettings(){await this.saveData(this.settings)}updateModifyEventListener(){this.modifyEventRef&&this.app.vault.offref(this.modifyEventRef),this.modifyEventRef=this.app.metadataCache.on("changed",(0,p.debounce)(this.handleEditorChange.bind(this),this.settings.updateDelay,!0)),this.registerEvent(this.modifyEventRef)}async handleEditorChange(){let t=this.app.workspace.activeEditor,n=t?.editor,i=t?.file??void 0;!t||!n||!i||new M(this.app,this,n,i)}};

/* nosourcemap */