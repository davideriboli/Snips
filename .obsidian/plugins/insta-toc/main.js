/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var L=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ie=Object.prototype.hasOwnProperty;var se=(i,t)=>{for(var e in t)L(i,e,{get:t[e],enumerable:!0})},oe=(i,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ne(t))!ie.call(i,s)&&s!==e&&L(i,s,{get:()=>t[s],enumerable:!(n=te(t,s))||n.enumerable});return i};var re=i=>oe(L({},"__esModule",{value:!0}),i);var Le={};se(Le,{default:()=>M});module.exports=re(Le);var f=require("obsidian");var d={defaultMerge:Symbol("deepmerge-ts: default merge"),skip:Symbol("deepmerge-ts: skip")},Re={defaultMerge:d.defaultMerge};function ae(i,t){return t}function ce(i,t){return i.filter(e=>e!==void 0)}var $;(function(i){i[i.NOT=0]="NOT",i[i.RECORD=1]="RECORD",i[i.ARRAY=2]="ARRAY",i[i.SET=3]="SET",i[i.MAP=4]="MAP",i[i.OTHER=5]="OTHER"})($||($={}));function O(i){return typeof i!="object"||i===null?0:Array.isArray(i)?2:ue(i)?1:i instanceof Set?3:i instanceof Map?4:5}function le(i){let t=new Set;for(let e of i)for(let n of[...Object.keys(e),...Object.getOwnPropertySymbols(e)])t.add(n);return t}function de(i,t){return typeof i=="object"&&Object.prototype.propertyIsEnumerable.call(i,t)}function j(i){let t=0,e=i[0]?.[Symbol.iterator]();return{[Symbol.iterator](){return{next(){do{if(e===void 0)return{done:!0,value:void 0};let n=e.next();if(n.done===!0){t+=1,e=i[t]?.[Symbol.iterator]();continue}return{done:!1,value:n.value}}while(!0)}}}}}var V=["[object Object]","[object Module]"];function ue(i){if(!V.includes(Object.prototype.toString.call(i)))return!1;let{constructor:t}=i;if(t===void 0)return!0;let e=t.prototype;return!(e===null||typeof e!="object"||!V.includes(Object.prototype.toString.call(e))||!e.hasOwnProperty("isPrototypeOf"))}function ge(i,t,e){let n={};for(let s of le(i)){let o=[];for(let a of i)de(a,s)&&o.push(a[s]);if(o.length===0)continue;let r=t.metaDataUpdater(e,{key:s,parents:i}),c=U(o,t,r);c!==d.skip&&(s==="__proto__"?Object.defineProperty(n,s,{value:c,configurable:!0,enumerable:!0,writable:!0}):n[s]=c)}return n}function pe(i){return i.flat()}function fe(i){return new Set(j(i))}function he(i){return new Map(j(i))}function me(i){return i.at(-1)}var y={mergeRecords:ge,mergeArrays:pe,mergeSets:fe,mergeMaps:he,mergeOthers:me};function B(...i){return ve({})(...i)}function ve(i,t){let e=ye(i,n);function n(...s){return U(s,e,t)}return n}function ye(i,t){return{defaultMergeFunctions:y,mergeFunctions:{...y,...Object.fromEntries(Object.entries(i).filter(([e,n])=>Object.hasOwn(y,e)).map(([e,n])=>n===!1?[e,y.mergeOthers]:[e,n]))},metaDataUpdater:i.metaDataUpdater??ae,deepmerge:t,useImplicitDefaultMerging:i.enableImplicitDefaultMerging??!1,filterValues:i.filterValues===!1?void 0:i.filterValues??ce,actions:d}}function U(i,t,e){let n=t.filterValues?.(i,e)??i;if(n.length===0)return;if(n.length===1)return C(n,t,e);let s=O(n[0]);if(s!==0&&s!==5){for(let o=1;o<n.length;o++)if(O(n[o])!==s)return C(n,t,e)}switch(s){case 1:return Te(n,t,e);case 2:return Se(n,t,e);case 3:return be(n,t,e);case 4:return xe(n,t,e);default:return C(n,t,e)}}function Te(i,t,e){let n=t.mergeFunctions.mergeRecords(i,t,e);return n===d.defaultMerge||t.useImplicitDefaultMerging&&n===void 0&&t.mergeFunctions.mergeRecords!==t.defaultMergeFunctions.mergeRecords?t.defaultMergeFunctions.mergeRecords(i,t,e):n}function Se(i,t,e){let n=t.mergeFunctions.mergeArrays(i,t,e);return n===d.defaultMerge||t.useImplicitDefaultMerging&&n===void 0&&t.mergeFunctions.mergeArrays!==t.defaultMergeFunctions.mergeArrays?t.defaultMergeFunctions.mergeArrays(i):n}function be(i,t,e){let n=t.mergeFunctions.mergeSets(i,t,e);return n===d.defaultMerge||t.useImplicitDefaultMerging&&n===void 0&&t.mergeFunctions.mergeSets!==t.defaultMergeFunctions.mergeSets?t.defaultMergeFunctions.mergeSets(i):n}function xe(i,t,e){let n=t.mergeFunctions.mergeMaps(i,t,e);return n===d.defaultMerge||t.useImplicitDefaultMerging&&n===void 0&&t.mergeFunctions.mergeMaps!==t.defaultMergeFunctions.mergeMaps?t.defaultMergeFunctions.mergeMaps(i):n}function C(i,t,e){let n=t.mergeFunctions.mergeOthers(i,t,e);return n===d.defaultMerge||t.useImplicitDefaultMerging&&n===void 0&&t.mergeFunctions.mergeOthers!==t.defaultMergeFunctions.mergeOthers?t.defaultMergeFunctions.mergeOthers(i):n}var m="insta-toc",N=/^(\s*)(-|\d+(?:\.\d+)*|\d\.)\s+(.*)/,E=/\[\[([^\]]+)\|([^\]]+)\]\]/g,R=/\[\[([^\]\|]+)\]\]/g,k=/\[([^\]]+)\]\([^)]+\)/g,z=/(#)([/\-_\w][^\s]*)/g;var T=/-{3}\n([\s\S]*)\n-{3}/,Y={dash:"dash",number:"number"},G=["*","_","`","==","~~","{","}","#","\\"],p={title:{name:"Table of Contents",level:1},exclude:"",style:{listType:"dash"},omit:[],levels:{min:1,max:6}};var P={bulletType:"dash",indentSize:4,updateDelay:2e3,excludedChars:G};var u=require("obsidian");var S=class extends u.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new u.Setting(t).setName("List bullet style").setDesc("Select the global list bullet type.").addDropdown(e=>e.addOptions(Y).setValue(this.plugin.settings.bulletType).onChange(async n=>{this.plugin.settings.bulletType=n,await this.plugin.saveSettings()})),new u.Setting(t).setName("Indentation width").setDesc("Select the global indentation size.").addSlider(e=>e.setLimits(2,8,2).setDynamicTooltip().setInstant(!0).setValue(this.plugin.settings.indentSize).onChange(async n=>{this.plugin.settings.indentSize=n,await this.plugin.saveSettings()})),new u.Setting(t).setName("Update delay").setDesc("The delay for each TOC update.").addSlider(e=>{e.setLimits(500,1e4,500).setDynamicTooltip().setInstant(!0).setValue(this.plugin.settings.updateDelay).onChange(async n=>{this.plugin.settings.updateDelay=n,await this.plugin.saveSettings(),this.plugin.updateModifyEventListener()})}),new u.Setting(t).setName("Excluded characters").setDesc("Characters to exclude in headings.").addTextArea(e=>{e.setValue([...new Set(this.plugin.settings.excludedChars)].join(",")).onChange(async n=>{let s=e.getValue(),o=new Set([...this.plugin.settings.excludedChars,...s.replace(/^,/,"").replace(/,$/,"").split(",").map(r=>r.trim())]);this.plugin.settings.excludedChars=[...o],await this.plugin.saveSettings()}),e.inputEl.classList.add("exclude-chars")})}};var w=require("obsidian");var b=class{constructor(t,e){this.plugin=t,this.validator=e,this.headingLevelStack=[],this.updateAutoToc()}getIndentationLevel(t){for(;this.headingLevelStack.length>0&&t<=this.headingLevelStack[this.headingLevelStack.length-1];)this.headingLevelStack.pop();return this.headingLevelStack.push(t),this.headingLevelStack.length-1}generateNumberedToc(){let t=[],e={},n=this.validator.fileHeadings;for(let o of n){let r=o.level,c=o.heading,a=this.getIndentationLevel(r);e[a]||(e[a]=0);for(let g=a+1;g<=6;g++)e[g]=0;e[a]++;let l=" ".repeat(a*4),h=e[a].toString(),v=`${l}${h}. ${c}`;t.push(v)}return`\`\`\`${`${m}
---
${(0,w.stringifyYaml)(this.validator.localTocSettings)}---

${"#".repeat(this.validator.localTocSettings.title.level)} ${this.validator.localTocSettings.title.name}

${t.join(`
`)}`}
\`\`\``}generateNormalToc(){let t=[],e=this.validator.fileHeadings;for(let s of e){let o=s.level,r=s.heading,c=this.getIndentationLevel(o),l=`${" ".repeat(c*4)}- ${r}`;t.push(l)}return`\`\`\`${`${m}
---
${(0,w.stringifyYaml)(this.validator.localTocSettings)}---

${"#".repeat(this.validator.localTocSettings.title.level)} ${this.validator.localTocSettings.title.name}

${t.join(`
`)}`}
\`\`\``}updateAutoToc(){let t=this.validator.tocInsertPos,e=this.plugin.settings.bulletType!==this.validator.localTocSettings.style.listType?this.validator.localTocSettings.style.listType:this.plugin.settings.bulletType,n;switch(e){case"dash":n=this.generateNormalToc();break;case"number":n=this.generateNumberedToc();break;default:n=this.generateNormalToc();break}this.plugin.isPluginEdit=!0,this.validator.editor.replaceRange(n,t.from,t.to)}};var W=require("obsidian");function q(i,t,e,n,s){let[,o,r,c]=n,{contentText:a,alias:l}=Ie(t,c),h=i.fileManager.generateMarkdownLink(e,s,`#${a}`,l);return{indent:o,bullet:r,navLink:h}}function Ie(i,t){let[e,n]=[t,t];return e=e.replace(E,(s,o,r)=>`${o} ${r}`),n=n.replace(E,(s,o,r)=>r),e=e.replace(R,(s,o)=>(o=o.split("/").pop()??o,o)),n=n.replace(R,(s,o)=>(o=o.split("/").pop()??o,o)),e=e.replace(k,(s,o)=>s),n=n.replace(k,(s,o)=>o),e=e.replace(z,(s,o,r)=>r),n=Me(n,i),{contentText:e,alias:n}}function Me(i,t,e){let n=(t?t.settings.excludedChars:e)??[],s=(0,W.htmlToMarkdown)(i);for(let o of n)s=s.replaceAll(o,"");return s}function _(i,t,e){i.querySelectorAll("li").forEach((s,o)=>{t[o]>1&&(s.style.marginInlineStart=`${e*10}px`);let c=s.querySelector("ul, ol");if(c){let a=document.createElement("button");a.textContent="\u25BE",a.classList.add("fold-toggle"),a.addEventListener("click",()=>{c.style.display==="none"?(c.style.display="",a.textContent="\u25BE"):(c.style.display="none",a.textContent="\u25B8")}),s.prepend(a)}})}function K(i){let t=i.workspace.activeEditor?.editor,e=t?.getCursor();return{editor:t,cursorPos:e}}function D(i){return i.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function J(i){return/^\/.*\/$/.test(i)}function x(i){return[1,2,3,4,5,6].includes(i)}function A(i){return i&&typeof i=="object"&&!Array.isArray(i)}function H(i,t){if(A(i)&&A(t))for(let e of Object.keys(t)){let n=i[e],s=t[e];A(s)?(n||(i[e]={}),H(i[e],s)):Array.isArray(n)&&Array.isArray(s)?i[e]=[...new Set([...n,...s])]:i[e]=s}return i}var Q=require("obsidian");var I=class{constructor(t,e,n,s){this.plugin=t,this.metadata=e,this.editor=n,this.cursorPos=s,this.localTocSettings=p}update(t,e,n,s){this.plugin=t,this.metadata=e,this.editor=n,this.cursorPos=s,this.localTocSettings=p}haveHeadingsChanged(){let t=this.metadata.headings||[];return this.previousHeadings?t.every((n,s)=>n.heading===this.previousHeadings[s].heading&&n.level===this.previousHeadings[s].level)?!1:(this.previousHeadings=t,!0):(this.previousHeadings=t,!0)}hasHeadingsAndSections(){return!!this.metadata&&!!this.metadata.headings&&!!this.metadata.sections}hasInstaTocSection(){if(!this.hasHeadingsAndSections())return!1;let t=this.metadata.sections.find(e=>e.type==="code"&&this.editor.getLine(e.position.start.line)===`\`\`\`${m}`);return t?(this.instaTocSection=t,!0):!1}setTocInsertPos(){let t=this.instaTocSection.position.start.line,e=0,n=this.instaTocSection.position.end.line,s=this.instaTocSection.position.end.col,o={line:t,ch:e},r={line:n,ch:s};this.tocInsertPos={from:o,to:r}}configureLocalSettings(){let e=this.editor.getRange(this.tocInsertPos.from,this.tocInsertPos.to).match(T);if(!e)return;let[,n]=e;this.validateLocalSettings(n)}validateLocalSettings(t){let e;try{e=(0,Q.parseYaml)(t)}catch(s){console.error(`Invalid YAML in insta-toc settings:
`,s),this.localTocSettings={...p};return}let n=[];if(e.title!==void 0){let s=e.title;if(typeof s!="object"||s===null)n.push("'title' must be an object.");else{let{name:o,level:r}=s;o!==void 0&&typeof o!="string"&&n.push("'title.name' must be a string."),r!==void 0&&!x(r)&&n.push("'title.level' must be an integer between 1 and 6.")}}if(e.exclude!==void 0&&typeof e.exclude!="string"&&n.push("'exclude' must be a string."),e.style!==void 0){let s=e.style;if(typeof s!="object"||s===null)n.push("'style' must be an object.");else{let{listType:o}=s;o!==void 0&&!["dash","number"].includes(o)&&n.push("'style.listType' must be 'dash' or 'number'.")}}if(e.omit!==void 0){if(!Array.isArray(e.omit))n.push("'omit' must be an array of strings.");else for(let s of e.omit)if(typeof s!="string"){n.push("'omit' array must contain only strings.");break}}if(e.levels!==void 0){let s=e.levels;if(typeof s!="object"||s===null)n.push("'levels' must be an object.");else{let{min:o,max:r}=s;o!==void 0&&!x(o)&&n.push("'levels.min' must be an integer between 1 and 6."),r!==void 0&&!x(r)&&n.push("'levels.max' must be an integer between 1 and 6."),o!==void 0&&r!==void 0&&o>r&&n.push("'levels.min' cannot be greater than 'levels.max'.")}}if(n.length>0){let s=`Invalid properties in insta-toc settings:
`+n.join(`
`);console.error(s),new Notice(s),this.localTocSettings=p}else this.localTocSettings=H(p,e)}cursorInToc(){return this.cursorPos.line>=this.instaTocSection.position.start.line&&this.cursorPos.line<=this.instaTocSection.position.end.line}setFileHeadings(){this.metadata.headings&&(this.fileHeadings=this.metadata.headings.filter(t=>!t.heading.match(/<!--\s*omit\s*-->/)&&!this.localTocSettings.omit.includes(t.heading)&&t.level>=this.localTocSettings.levels.min&&t.level<=this.localTocSettings.levels.max).map(t=>{let e=t.heading,n=[];if(this.plugin.settings.excludedChars&&this.plugin.settings.excludedChars.length>0){let s=this.plugin.settings.excludedChars.map(o=>D(o)).join("");s.length>0&&n.push(`[${s}]`)}if(this.localTocSettings.exclude&&this.localTocSettings.exclude.length>0){let s=this.localTocSettings.exclude;if(J(s)){let o=s.slice(1,-1);n.push(`(${o})`)}else{let o=D(s);o.length>0&&n.push(`[${o}]`)}}if(n.length>0){let s=new RegExp(n.join("|"),"g");e=e.replace(s,"")}return{...t,heading:e}}))}isValid(){return this.hasInstaTocSection()?this.haveHeadingsChanged()?(this.setTocInsertPos(),this.configureLocalSettings(),this.setFileHeadings(),!this.cursorInToc()):!1:(this.plugin.hasTocBlock=!1,!1)}};var M=class extends f.Plugin{constructor(e,n){super(e,n);this.isPluginEdit=!1;this.hasTocBlock=!0;this.getDelay=()=>this.settings.updateDelay;this.app=e}async onload(){console.log("Loading Insta TOC Plugin"),await this.loadSettings(),this.addSettingTab(new S(this.app,this)),this.registerMarkdownCodeBlockProcessor("insta-toc",async(e,n,s)=>{this.hasTocBlock||(console.log("processor setting hasTocBlock to true."),this.hasTocBlock=!0);let o=s.sourcePath,r=o.substring(0,o.lastIndexOf(".")),c=this.app.vault.getAbstractFileByPath(o),a=e.replace(T,"").split(`
`),l=[],h=a.map(v=>{let g=v.match(N);if(!g)return v;let{indent:F,bullet:X,navLink:Z}=q(this.app,this,c,g,r),ee=Math.floor(F.length/4)+1;return l.push(ee),`${F}${X} ${Z}`}).join(`
`);await f.MarkdownRenderer.render(this.app,h,n,o,this),_(n,l,this.settings.indentSize)}),this.registerEvent(this.app.workspace.on("file-open",()=>this.hasTocBlock=!0)),this.updateModifyEventListener()}onunload(){console.log("Insta TOC Plugin Unloaded.")}async loadSettings(){let e=P,n=await this.loadData();n&&(e=B(P,n)),this.settings=e}async saveSettings(){await this.saveData(this.settings)}updateModifyEventListener(){this.modifyEventRef&&this.app.metadataCache.offref(this.modifyEventRef),this.setDebouncer(),this.modifyEventRef=this.app.metadataCache.on("changed",(e,n,s)=>{this.hasTocBlock&&this.debouncer(s)}),this.registerEvent(this.modifyEventRef)}setDebouncer(){this.debouncer=(0,f.debounce)(e=>{if(this.isPluginEdit){this.isPluginEdit=!1;return}let{editor:n,cursorPos:s}=K(this.app);if(!n||!s)return;this.validator?this.validator.update(this,e,n,s):this.validator=new I(this,e,n,s),this.validator.isValid()&&new b(this,this.validator)},this.settings.updateDelay,!1)}};

/* nosourcemap */